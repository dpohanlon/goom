#include "pico/stdlib.h"
#include "hardware/pwm.h"

const float note_duty[85] = {
4.166666666666666,
5.555555555555556,
5.555555555555556,
6.944444444444444,
8.333333333333332,
8.333333333333332,
9.722222222222221,
11.111111111111112,
12.5,
12.5,
13.88888888888889,
15.277777777777777,
15.277777777777777,
16.666666666666664,
18.055555555555554,
18.055555555555554,
19.444444444444446,
20.833333333333336,
22.22222222222222,
22.22222222222222,
23.611111111111114,
25.0,
25.0,
26.38888888888889,
27.777777777777775,
29.166666666666668,
29.166666666666668,
30.555555555555557,
31.944444444444443,
31.944444444444443,
33.33333333333333,
34.722222222222214,
34.722222222222214,
36.111111111111114,
37.5,
38.888888888888886,
38.888888888888886,
40.277777777777786,
41.66666666666667,
41.66666666666667,
43.05555555555555,
44.44444444444445,
45.83333333333333,
45.83333333333333,
47.222222222222214,
48.611111111111114,
48.611111111111114,
50.0,
51.38888888888889,
51.38888888888889,
52.77777777777778,
54.166666666666664,
55.55555555555556,
55.55555555555556,
56.94444444444444,
58.333333333333336,
58.333333333333336,
59.72222222222222,
61.11111111111111,
62.5,
62.5,
63.88888888888889,
65.27777777777779,
65.27777777777779,
66.66666666666666,
68.05555555555557,
68.05555555555557,
69.44444444444443,
70.83333333333334,
72.22222222222223,
72.22222222222223,
73.6111111111111,
75.0,
75.0,
76.3888888888889,
77.77777777777777,
79.16666666666666,
79.16666666666666,
80.55555555555557,
81.94444444444443,
81.94444444444443,
83.33333333333334,
84.72222222222221,
84.72222222222221,
86.11111111111111};

int main() {
    // Initialize the standard library, which also configures the GPIOs.
    stdio_init_all();

    // Choose a GPIO for PWM output. For this example, let's use GPIO 2.
    const uint PWM_PIN = 2;

    // Set up the GPIO for PWM output.
    gpio_set_function(PWM_PIN, GPIO_FUNC_PWM);

    // Retrieve the PWM slice for the chosen GPIO.
    uint slice_num = pwm_gpio_to_slice_num(PWM_PIN);

    // Set the PWM frequency.
    // For example, to have a 1kHz frequency, we set a wrap value of 47999.
    pwm_set_wrap(slice_num, 47999);  // 1ms period at 48MHz system clock.

    // Enable PWM.
    pwm_set_enabled(slice_num, true);

    float percent_duty = 480;

    while (1) {

        for (uint16_t note = 1; note < 86; note++) {

            int duty_cycle = (int)(percent_duty * note);

            pwm_set_chan_level(slice_num, PWM_CHAN_A, duty_cycle);
            sleep_ms(1000);
        }

    }

    return 0;
}
